<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepMind™ | Reprogramação Neural</title>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuração do Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        deep: {
                            900: '#0a0a0f', 
                            800: '#13131f', 
                        },
                        neon: {
                            purple: '#a855f7',
                            violet: '#8b5cf6',
                            glow: '#d8b4fe'
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050507;
            background-image: 
                radial-gradient(circle at 50% 0%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(168, 85, 247, 0.1) 0%, transparent 40%);
            color: #e2e8f0;
            overflow-x: hidden;
        }

        .glass {
            background: rgba(19, 19, 31, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(139, 92, 246, 0.1);
        }

        select, input, textarea {
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(139, 92, 246, 0.2);
            color: white;
            transition: all 0.3s ease;
        }
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #a855f7;
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.3);
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0a0f; }
        ::-webkit-scrollbar-thumb { background: #4c1d95; border-radius: 4px; }

        .hypnosis-content h2 { color: #d8b4fe; font-size: 1.5rem; margin-top: 1.5rem; margin-bottom: 0.5rem; font-weight: 600; }
        .hypnosis-content p { margin-bottom: 1rem; line-height: 1.8; color: #cbd5e1; }
        .hypnosis-content strong { color: #a855f7; }
        
        /* Utilitários de visibilidade e animação */
        .hidden-screen { display: none !important; }
        .fade-in { animation: fadeIn 0.8s ease-out forwards; }
        .fade-out { animation: fadeOut 0.5s ease-out forwards; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col justify-center items-center p-4">

    <!-- Áudio de Fundo (Theta Waves / Dark Ambient) -->
    <!-- Fonte: Pixabay (Royalty Free) -->
    <audio id="ambient-audio" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/02/07/audio_1829e71048.mp3" type="audio/mp3">
    </audio>

    <!-- ================= TELA 1: HERO ================= -->
    <main id="screen-hero" class="text-center max-w-4xl w-full fade-in relative z-10">
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] bg-violet-600 rounded-full blur-[120px] opacity-20 -z-10 animate-pulse-slow"></div>

        <h3 class="text-neon-purple tracking-[0.3em] text-sm uppercase font-semibold mb-4 animate-float">Arquitetura Neural & Hipnose Guiada</h3>
        
        <h1 class="text-5xl md:text-7xl font-bold mb-6 text-white leading-tight drop-shadow-[0_0_15px_rgba(139,92,246,0.5)]">
            DeepMind<span class="text-2xl align-top text-neon-violet">™</span>
        </h1>
        
        <p class="text-slate-400 text-lg md:text-xl max-w-2xl mx-auto mb-10 font-light">
            Reprograme seu subconsciente através de sessões de hipnoterapia personalizadas por Inteligência Artificial.
        </p>

        <button onclick="goToForm()" class="group relative px-8 py-4 bg-transparent border border-neon-violet text-white font-semibold rounded-full overflow-hidden transition-all duration-300 hover:shadow-[0_0_30px_rgba(168,85,247,0.4)]">
            <span class="absolute top-0 left-0 w-full h-full bg-violet-600 opacity-0 group-hover:opacity-20 transition-opacity"></span>
            <span class="relative z-10 flex items-center gap-2">
                Iniciar Reprogramação
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transform group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                </svg>
            </span>
        </button>
    </main>

    <!-- ================= TELA 2: FORMULÁRIO ================= -->
    <main id="screen-form" class="hidden-screen w-full max-w-lg fade-in">
        <div class="glass p-8 rounded-2xl shadow-2xl border-t border-white/10">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-white mb-2">Configuração da Sessão</h2>
                <div class="h-1 w-20 bg-gradient-to-r from-violet-500 to-fuchsia-500 mx-auto rounded-full"></div>
            </div>

            <form id="hypnosisForm" onsubmit="handleGenerate(event)" class="space-y-6">
                
                <!-- Pergunta 1 -->
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-neon-glow">Qual hábito deseja eliminar?</label>
                    <select id="habit" onchange="checkOther(this)" class="w-full p-3 rounded-lg text-sm focus:ring-2 focus:ring-violet-500">
                        <option value="" disabled selected>Selecione uma opção...</option>
                        <option value="Fumar">Fumar</option>
                        <option value="Beber">Beber</option>
                        <option value="Comer compulsivamente">Comer compulsivamente</option>
                        <option value="Procrastinação">Procrastinação</option>
                        <option value="Jogos e Apostas">Jogos / Apostas</option>
                        <option value="Vício em Redes Sociais">Vício em Redes Sociais</option>
                        <option value="Ansiedade">Ansiedade</option>
                        <option value="Estresse Emocional">Estresse Emocional</option>
                        <option value="Outro">Outro...</option>
                    </select>
                    <input type="text" id="habit-other" placeholder="Descreva o hábito..." class="hidden w-full p-3 mt-2 rounded-lg text-sm border-l-4 border-l-violet-500">
                </div>

                <!-- Pergunta 2 -->
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-neon-glow">Há quanto tempo isso te afeta?</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="cursor-pointer">
                            <input type="radio" name="duration" value="Menos de 6 meses" class="peer sr-only" required>
                            <div class="p-3 text-xs text-center border border-white/20 rounded-lg hover:bg-white/5 peer-checked:bg-violet-600 peer-checked:border-violet-500 peer-checked:text-white transition-all">Menos de 6 meses</div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="duration" value="6 meses a 1 ano" class="peer sr-only">
                            <div class="p-3 text-xs text-center border border-white/20 rounded-lg hover:bg-white/5 peer-checked:bg-violet-600 peer-checked:border-violet-500 peer-checked:text-white transition-all">6 meses a 1 ano</div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="duration" value="1 a 3 anos" class="peer sr-only">
                            <div class="p-3 text-xs text-center border border-white/20 rounded-lg hover:bg-white/5 peer-checked:bg-violet-600 peer-checked:border-violet-500 peer-checked:text-white transition-all">1 a 3 anos</div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="duration" value="Mais de 3 anos" class="peer sr-only">
                            <div class="p-3 text-xs text-center border border-white/20 rounded-lg hover:bg-white/5 peer-checked:bg-violet-600 peer-checked:border-violet-500 peer-checked:text-white transition-all">Mais de 3 anos</div>
                        </label>
                        <label class="cursor-pointer col-span-2">
                            <input type="radio" name="duration" value="Desde sempre" class="peer sr-only">
                            <div class="p-3 text-xs text-center border border-white/20 rounded-lg hover:bg-white/5 peer-checked:bg-violet-600 peer-checked:border-violet-500 peer-checked:text-white transition-all">Desde sempre</div>
                        </label>
                    </div>
                </div>

                <!-- Pergunta 3 -->
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-neon-glow">Nível de Intensidade</label>
                    <div class="flex justify-between gap-4">
                        <label class="cursor-pointer flex-1">
                            <input type="radio" name="intensity" value="Leve" class="peer sr-only" required>
                            <div class="p-3 text-sm text-center border border-green-500/30 rounded-lg hover:bg-green-500/10 peer-checked:bg-green-600 peer-checked:border-green-500 text-green-300 peer-checked:text-white transition-all">Leve</div>
                        </label>
                        <label class="cursor-pointer flex-1">
                            <input type="radio" name="intensity" value="Moderado" class="peer sr-only">
                            <div class="p-3 text-sm text-center border border-yellow-500/30 rounded-lg hover:bg-yellow-500/10 peer-checked:bg-yellow-600 peer-checked:border-yellow-500 text-yellow-300 peer-checked:text-white transition-all">Moderado</div>
                        </label>
                        <label class="cursor-pointer flex-1">
                            <input type="radio" name="intensity" value="Forte" class="peer sr-only">
                            <div class="p-3 text-sm text-center border border-red-500/30 rounded-lg hover:bg-red-500/10 peer-checked:bg-red-600 peer-checked:border-red-500 text-red-300 peer-checked:text-white transition-all">Forte</div>
                        </label>
                    </div>
                </div>

                <button type="submit" id="btn-submit" class="w-full mt-6 py-4 bg-gradient-to-r from-violet-700 to-fuchsia-700 rounded-lg text-white font-bold tracking-wide shadow-lg hover:shadow-neon-violet/50 transition-all transform hover:-translate-y-1">
                    GERAR SESSÃO HIPNÓTICA
                </button>
            </form>
        </div>
    </main>

    <!-- ================= TELA DE LOADING ================= -->
    <div id="loading-screen" class="fixed inset-0 bg-deep-900 z-50 hidden-screen justify-center items-center flex-col">
        <div class="relative w-24 h-24">
            <div class="absolute inset-0 border-4 border-violet-900 rounded-full"></div>
            <div class="absolute inset-0 border-t-4 border-neon-purple rounded-full animate-spin"></div>
            <div class="absolute inset-4 bg-violet-500 rounded-full blur-xl opacity-40 animate-pulse"></div>
        </div>
        <p class="mt-8 text-neon-glow tracking-widest text-sm animate-pulse">SINCRONIZANDO ONDAS NEURAIS...</p>
        <p id="loading-text" class="mt-2 text-slate-500 text-xs">Analisando padrões comportamentais</p>
    </div>

    <!-- ================= TELA 3: RESULTADO ================= -->
    <main id="screen-result" class="hidden-screen w-full max-w-3xl fade-in pb-12">
        <div class="glass p-8 md:p-12 rounded-2xl shadow-[0_0_50px_rgba(139,92,246,0.15)] border border-white/10 relative">
            
            <!-- Botão de Ativar Som -->
            <button id="btn-audio-toggle" onclick="activateAudio()" class="w-full mb-8 py-3 bg-white/5 border border-neon-purple/50 rounded-lg text-neon-glow flex items-center justify-center gap-3 hover:bg-neon-purple/10 transition-all group">
                <span class="relative flex h-3 w-3">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-neon-purple opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-violet-500"></span>
                </span>
                <span class="font-medium tracking-wide text-sm">ATIVAR SOM AMBIENTE (BINAURAL)</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-neon-purple" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                </svg>
            </button>

            <div class="flex justify-between items-center mb-6 border-b border-white/10 pb-4">
                <h2 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-white to-violet-300">Sessão Gerada</h2>
                <button onclick="location.reload()" class="text-xs text-slate-400 hover:text-white transition-colors flex items-center gap-1">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    Nova Sessão
                </button>
            </div>

            <div id="result-content" class="hypnosis-content text-slate-300 text-justify">
                <!-- Conteúdo IA -->
            </div>

            <div class="mt-10 pt-6 border-t border-white/5 text-center">
                <p class="text-xs text-slate-600 italic">Recomenda-se ler em voz baixa ou gravar este script para ouvir diariamente.</p>
            </div>
        </div>
    </main>

    <script>
        const screenHero = document.getElementById('screen-hero');
        const screenForm = document.getElementById('screen-form');
        const screenResult = document.getElementById('screen-result');
        const loadingScreen = document.getElementById('loading-screen');
        const otherInput = document.getElementById('habit-other');
        const audioEl = document.getElementById('ambient-audio');
        const btnAudio = document.getElementById('btn-audio-toggle');

        function goToForm() {
            screenHero.classList.add('hidden-screen');
            screenForm.classList.remove('hidden-screen');
        }

        function checkOther(select) {
            if (select.value === "Outro") {
                otherInput.classList.remove('hidden');
                otherInput.required = true;
            } else {
                otherInput.classList.add('hidden');
                otherInput.required = false;
            }
        }

        // Função para ativar o áudio e esconder o botão
        function activateAudio() {
            audioEl.volume = 0.3; // 30% do volume para não atrapalhar
            audioEl.play().then(() => {
                // Adiciona classe de animação para sumir
                btnAudio.classList.add('fade-out');
                // Remove do DOM após a animação
                setTimeout(() => {
                    btnAudio.style.display = 'none';
                }, 500);
            }).catch(error => {
                console.error("Erro ao reproduzir áudio:", error);
                alert("Não foi possível iniciar o áudio automaticamente. Verifique as permissões do navegador.");
            });
        }

        async function handleGenerate(e) {
            e.preventDefault();

            const select = document.getElementById('habit');
            let habit = select.value;
            if (habit === "Outro") {
                habit = document.getElementById('habit-other').value;
            }
            if (!habit) return alert("Por favor, selecione um hábito.");

            const duration = document.querySelector('input[name="duration"]:checked').value;
            const intensity = document.querySelector('input[name="intensity"]:checked').value;

            screenForm.classList.add('hidden-screen');
            loadingScreen.classList.remove('hidden-screen');
            loadingScreen.style.display = 'flex';

            const steps = ["Mapeando gatilhos emocionais...", "Construindo sugestões pós-hipnóticas...", "Finalizando roteiro neural..."];
            let stepIndex = 0;
            const interval = setInterval(() => {
                if (stepIndex < steps.length) {
                    document.getElementById('loading-text').innerText = steps[stepIndex];
                    stepIndex++;
                }
            }, 1500);

            try {
                const response = await fetch('/api/ai', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ habit, duration, intensity })
                });

                const data = await response.json();

                clearInterval(interval);
                loadingScreen.classList.add('hidden-screen');
                loadingScreen.style.display = 'none';

                if (response.ok && data.result) {
                    document.getElementById('result-content').innerHTML = data.result;
                    screenResult.classList.remove('hidden-screen');
                } else {
                    alert("Erro ao gerar sessão. Tente novamente.");
                    screenForm.classList.remove('hidden-screen');
                }

            } catch (error) {
                console.error(error);
                clearInterval(interval);
                loadingScreen.classList.add('hidden-screen');
                loadingScreen.style.display = 'none';
                alert("Erro de conexão. Verifique sua internet.");
                screenForm.classList.remove('hidden-screen');
            }
        }
    </script>
</body>
</html>
